box:
  id: octoblu/arm-node-compile
  cmd: /bin/bash
build:
  steps:
    - script:
        name: compile
          # compile "https://$WERCKER_GIT_DOMAIN/$WERCKER_GIT_OWNER/$WERCKER_GIT_REPOSITORY" "$WERCKER_GIT_BRANCH"
        code: |
          git fetch
          compile "$WERCKER_SOURCE_DIR" "$WERCKER_OUTPUT_DIR"
          mv "${WERCKER_OUTPUT_DIR}/app-linux-arm.tar.gz" "${WERCKER_OUTPUT_DIR}/blink1-linux-arm.tar.gz"
          echo "$(git describe --tags)" > "${WERCKER_OUTPUT_DIR}/VERSION"
    # - internal/store-container
deploy:
  steps:
    - script:
        name: upload to github
        code: |
          echo "Releasing: $(cat "${WERCKER_ROOT}/VERSION")"
          github-release release -u octoblu -r meshblu-connector-blink1 --tag "$(cat "${WERCKER_ROOT}/VERSION")" || echo "Already released, skipping"
          github-release upload \
            --user octoblu \
            --repo meshblu-connector-blink1 \
            --tag "$(cat "${WERCKER_ROOT}/VERSION")" \
            --name "blink1-linux-arm.tar.gz" \
            --file "${WERCKER_ROOT}/blink1-linux-arm.tar.gz"
